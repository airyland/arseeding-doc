## 概述
本指南将帮助您使用 arseeding-js 快速开发 arseeding ANS-104 bundle 永存服务。     
本指南分别介绍了三种方式与 arseeding 永存服务进行交互。   
分别为:
- [数据上传同时费用支付](./快速入门指南.md#数据上传同时费用支付)
- [数据上传和费用支付解耦](./快速入门指南.md#数据上传和费用支付解耦)
- [使用 apiKey 直接提交数据](./快速入门指南.md#使用-apikey-直接提交数据)

### Import
```js
npm i arseeding-js
```
### 数据上传同时费用支付
#### 创建实例-私钥注入
此方式适用于 node 后端开发
```js
import { genNodeAPI } from 'arseeding-js'
const instance = await genNodeAPI('<YOUR PRIVATE KEY>')
```
#### 创建实例-MetaMask注入
此方式适用于 browser 开发
```js
import { genAPI } from 'arseeding-js'
const instance = await genAPI(window.ethereum)
```
#### 上传数据并支付
```js
const arseedUrl = 'https://arseed.web3infura.io'
const data = Buffer.from('need upload data ...')
const payCurrency = 'USDC' // everpay supported all tokens,like 'AR','ETH','USDT' and so on
const ops = {
    tags: [
        {name: "Content-Type",value:"data type"},
        {name: "aa",value:"aaa"}
    ]
}
const resp = await instance.sendAndPay(arseedUrl, data, payCurrency, ops)
```
- `arseedUrl`: 替换成自己部署的 arseeding server url
- `payCurrency`: 指定支付费用的 token, 可以使用 everpay 上的任意 token
- `tags`: 对上传数据打标签，可以打任意多个标签。注: 数据必须要有 `Content-Type` 标签用于描述数据类型，这样通过浏览器获取数据就可以直接被渲染出来
---

### 数据上传和费用支付解耦
为了满足更多的存储应用场景，arseeding-js 实现了数据上传和费用支付进行解耦的使用方式。

### 数据上传
#### 创建数据 Signer
支持 metamask, ecc 私钥和 rsa 私钥创建 signer
##### MetaMask
此方式适合需要用户使用 metamask 对数据签名场景。
```js
import { providers } from 'ethers'
import getCurrency from 'bundlr-arseeding-client/build/web/currencies'

const provider = new providers.Web3Provider(windowEthereum)
await provider._ready()
const currencyConfig = getCurrency('ethereum', provider)
await currencyConfig.ready()
const signer = await currencyConfig.getSigner()
```
##### ECC 私钥
此方式适合 nodejs 服务配置 ecc 类型的私钥专门用于签名的场景
```js
import EthereumSigner from 'arseeding-arbundles/src/signing/chains/ethereumSigner'

const privateKey = '<your ecc private key>'
const signer = new EthereumSigner(privateKey)
```
##### RSA 私钥
此方式适合 nodejs 服务配置 rsa 类型的私钥专门用于签名的场景
```js
import ArweaveSigner from "arseeding-arbundles/src/signing/chains/ArweaveSigner"

const wallet = JSON.parse(
    readFileSync(path.join(__dirname, "test_key.json")).toString(),
);
const signer = new ArweaveSigner(wallet)
```

#### 数据签名并上传
数据组装成 bundle Item，使用上面创建的 Signer 进行签名并上传到 arseeding 服务。
```js
const data = Buffer.from('<need upload data>')
const ops = {
    tags: [
        { name: 'key01', value: 'val01' },
        { name: 'Content-Type', value: 'imag/png' } // you should set the data type tag
    ]
}
const arseedingUrl = 'https://arseed.web3infura.io'
const payCurrency = 'USDC' // everpay supported all tokens, like 'AR','ETH','USDT' and so on
const order = await createAndSubmitItem(arseedingUrl, signer, data, ops, payCurrency)
```
- `arseedUrl`: 替换成自己部署的 arseeding server url
- `payCurrency`: 指定支付费用的 token, 可以使用 everpay 上的任意 token
- `tags`: 对上传数据打标签，可以打任意多个标签。注: 数据必须要有 `Content-Type` 标签用于描述数据类型，这样通过浏览器获取数据就可以直接被渲染出来
上传成功之后会返回 order, order 中包含了数据 id 以及需要支付费用的信息。下面是如何通过 order 信息使用 everPay 完成费用支付

### 费用支付
#### 三种方式创建 everPay 实例
支持 metamask, ecc 私钥和 rsa 私钥创建 everPay 实例
##### MetaMask
此方式一般是让用户端使用 metamask 对支付费用的 everPay 交易进行签名.
```js
import { providers } from 'ethers'
import Everpay from 'everpay'

const provider = new providers.Web3Provider(windowEthereum)
await provider._ready()
const accounts = await provider.listAccounts()
const account = accounts[0] ?? ''
const everpay = new Everpay({
  debug: debug,
  account: account,
  ethConnectedSigner: provider.getSigner(),
  chainType: 'ethereum' as any
})
```
##### ECC 私钥
此方式适合 nodejs 服务配置 ecc 类型的私钥专门发送支付费用的 everPay 交易
```js
import { newEverpayByEcc } from 'arseeding-js'

const eccPrivate = '<your ecc private key>'
const everpay = newEverpayByEcc(eccPrivate)
```
##### RSA 私钥
此方式适合 nodejs 服务配置 rsa 类型的私钥专门发送支付费用的 everPay 交易
```js
import { newEverpayByRSA } from 'arseeding-js'

const arJWK = '<your arweave wallet keyFile>'
const arAddress = '<your arweave wallet address>'
const everpay = newEverpayByRSA(arJWK, arAddress)
```
#### 使用 everpay 支付费用
```js
import { payOrder } from 'arseeding-js'
const everHash = await payOrder(everpay, order)
```
- `order`: 为上传数据返回的 order
- `everHash`: 用于支付费用的 everPay tx hash
---
### 使用 apiKey 直接提交数据
arseeding 支持通过 apikey 授权客户端直接提交 data 到服务端，这样的好处是客户端不需要使用私钥对 data 组装的 bundle item 进行签名。也不需要使用 everPay 进行存储费用支付。
arseeding 服务端收到 data 之后会使用自有的私钥组装签名 bundle item 并发送上链。
```js
const arseedingUrl = 'https://arseed.web3infura.io'
const apikey = '<your arseeding apiKey>'
const data = '<need upload data, such as a picture>'
const contentType = 'image/png'
const tags = {'a':'aa','b':'bb'}
const res = await submitByApikey(arseedingUrl,apikey,data,contentType, tags)
```
- `apiKey`: [申请 apiKey](../6.其他/arseeding%20apiKey.md)
- `contentType`: data 数据类型，用于在浏览器中获取数据时能直接被渲染出来。
---
